<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" /> 
    <title>vagrant and chef quickstart</title>
    <meta property="og:title" content="Vagrant and Chef Quickstart" />
    <meta name="twitter:title" content="Vagrant and Chef Quickstart" />  
    <meta name="description" content="data streaming, observability, automation, and random stuff">
    <meta property="og:description" content="data streaming, observability, automation, and random stuff">
    <meta name="twitter:description" content="data streaming, observability, automation, and random stuff"> 

    <meta name="author" content="Jorge Esteban Quilcate Otoya" />
    <meta property="og:site_name" content="@jeqo" />
    <meta property="og:url" content="https://jeqo.github.io/posts/2014-11-26-vagrant-quickstart/" /> 
    <meta name="twitter:card" content="summary" /> 
    <meta name="twitter:site" content="@jeqo89" />
    <meta name="twitter:creator" content="@jeqo89" />  
    <meta property="og:type" content="article" /> 

    <link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>
    <link rel="stylesheet" href="https://jeqo.github.io/css/style.css" />
    <link rel='icon' type='image/x-icon' href="https://jeqo.github.io/images/favicon.ico" />
    <script type="text/javascript" src="https://jeqo.github.io/js/bundle.js"></script>
    

</head>

<body>
    <a href="#main" class="skip-link p-screen-reader-text">Skip to content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;" aria-hidden="true">
    <symbol id="icon-feed" viewBox="0 0 16 16">
        <g>
            <path
                d="M2.13 11.733c-1.175 0-2.13.958-2.13 2.126 0 1.174.955 2.122 2.13 2.122a2.126 2.126 0 0 0 2.133-2.122 2.133 2.133 0 0 0-2.133-2.126zM.002 5.436v3.067c1.997 0 3.874.781 5.288 2.196a7.45 7.45 0 0 1 2.192 5.302h3.08c0-5.825-4.739-10.564-10.56-10.564zM.006 0v3.068C7.128 3.068 12.924 8.87 12.924 16H16C16 7.18 8.824 0 .006 0z" />
        </g>
    </symbol>
    <symbol id="icon-github" viewBox="0 0 16 16">
        <g>
            <path
                d="M8 .198a8 8 0 0 0-2.529 15.591c.4.074.547-.174.547-.385 0-.191-.008-.821-.011-1.489-2.226.484-2.695-.944-2.695-.944-.364-.925-.888-1.171-.888-1.171-.726-.497.055-.486.055-.486.803.056 1.226.824 1.226.824.714 1.223 1.872.869 2.328.665.072-.517.279-.87.508-1.07-1.777-.202-3.645-.888-3.645-3.954 0-.873.313-1.587.824-2.147-.083-.202-.357-1.015.077-2.117 0 0 .672-.215 2.201.82A7.672 7.672 0 0 1 8 4.066c.68.003 1.365.092 2.004.269 1.527-1.035 2.198-.82 2.198-.82.435 1.102.162 1.916.079 2.117.513.56.823 1.274.823 2.147 0 3.073-1.872 3.749-3.653 3.947.287.248.543.735.543 1.481 0 1.07-.009 1.932-.009 2.195 0 .213.144.462.55.384A8 8 0 0 0 8.001.196z" />
        </g>
    </symbol>
    <symbol id="icon-linkedin" viewBox="0 0 16 16">
        <g>
            <path
                d="M6 6h2.767v1.418h.04C9.192 6.727 10.134 6 11.539 6 14.46 6 15 7.818 15 10.183V15h-2.885v-4.27c0-1.018-.021-2.329-1.5-2.329-1.502 0-1.732 1.109-1.732 2.255V15H6V6zM1 6h3v9H1V6zM4 3.5a1.5 1.5 0 1 1-3.001-.001A1.5 1.5 0 0 1 4 3.5z" />
        </g>
    </symbol>
    <symbol id="icon-mail" viewBox="0 0 22 18">
        <g>
            <path fill="#000"
                d="M0 17.225V.776h22v16.447H0v.002zm3.011-1.815h15.978l-5.111-5.115L11 13.179l-2.877-2.883-5.112 5.114zm-1.216-1.275l5.077-5.09L1.795 3.98v10.155zm13.332-5.09l5.079 5.09V3.979l-5.079 5.066zm-4.126 1.588l8.022-8.027-16.045-.001 8.023 8.028z" />
        </g>
    </symbol>
    <symbol id="icon-search" viewBox="0 0 16 16">
        <g>
            <path
                d="M15.504 13.616l-3.79-3.223c-.392-.353-.811-.514-1.149-.499a6 6 0 1 0-.672.672c-.016.338.146.757.499 1.149l3.223 3.79c.552.613 1.453.665 2.003.115s.498-1.452-.115-2.003zM6 10a4 4 0 1 1 0-8 4 4 0 0 1 0 8z" />
        </g>
    </symbol>
    <symbol id="icon-twitter" viewBox="0 0 16 16">
        <g>
            <path
                d="M16 3.538a6.461 6.461 0 0 1-1.884.516 3.301 3.301 0 0 0 1.444-1.816 6.607 6.607 0 0 1-2.084.797 3.28 3.28 0 0 0-2.397-1.034 3.28 3.28 0 0 0-3.197 4.028 9.321 9.321 0 0 1-6.766-3.431 3.284 3.284 0 0 0 1.015 4.381A3.301 3.301 0 0 1 .643 6.57v.041A3.283 3.283 0 0 0 3.277 9.83a3.291 3.291 0 0 1-1.485.057 3.293 3.293 0 0 0 3.066 2.281 6.586 6.586 0 0 1-4.862 1.359 9.286 9.286 0 0 0 5.034 1.475c6.037 0 9.341-5.003 9.341-9.341 0-.144-.003-.284-.009-.425a6.59 6.59 0 0 0 1.637-1.697z" />
        </g>
    </symbol>
    <symbol id="icon-keybase" viewBox="0 0 50 50">
        <g>
            <path
                d="M 24.433594 3.0019531 C 24.214219 3.0163281 23.998672 3.1032656 23.826172 3.2597656 C 23.70669 3.369165 22.227427 4.7384267 20.789062 6.9453125 C 20.493313 6.3897739 19.914285 6 19.25 6 L 14.75 6 C 13.794937 6 13 6.7949372 13 7.75 L 13 12.25 C 13 13.205063 13.794937 14 14.75 14 L 18.095703 14 C 18.038214 14.490889 18 14.988881 18 15.5 C 18 19.636 21.364 23 25.5 23 C 29.636 23 33 19.636 33 15.5 C 33 11.364 29.636 8 25.5 8 C 25.122 8 25.041812 7.8810781 25.007812 7.8300781 C 24.614813 7.2520781 24.999734 5.4491406 25.427734 4.3691406 C 25.599734 3.9371406 25.451359 3.4427344 25.068359 3.1777344 C 24.876359 3.0457344 24.652969 2.9875781 24.433594 3.0019531 z M 15 8 L 19 8 L 19 10.417969 C 18.803248 10.926943 18.627384 11.452559 18.480469 12 L 15 12 L 15 8 z M 16.646484 18.917969 C 9.2184844 22.402969 5 30.302 5 41 L 5 44 L 6.7246094 41.701172 C 7.0915267 43.013922 7.5755083 44.27612 8.1894531 45.460938 A 1.0002334 1.0002334 0 0 0 9.9648438 44.539062 C 9.1849975 43.034082 8.6252974 41.406022 8.3066406 39.693359 C 9.8157619 37.873526 11.472447 36.122537 13.066406 34.650391 C 12.538406 36.060391 12.183812 37.471953 12.007812 38.876953 L 11.693359 41.390625 L 13.640625 39.767578 C 13.696625 39.720578 19.437 35 26 35 C 29.219 35 30.97925 35.2985 32.53125 35.5625 C 33.86125 35.7875 35.118 36 37 36 C 40.1 36 41.797109 34.415625 42.537109 32.515625 C 42.734109 33.359625 42.872359 34.222563 42.943359 35.101562 C 42.979359 35.564563 43 36.03 43 36.5 C 43 39.318 42.33725 42.021062 41.03125 44.539062 C 40.77725 45.029063 40.968984 45.634672 41.458984 45.888672 C 41.605984 45.964672 41.764922 46 41.919922 46 C 42.280922 46 42.630594 45.804937 42.808594 45.460938 C 44.263594 42.656937 45 39.642 45 36.5 C 45 35.977 44.9785 35.456406 44.9375 34.941406 C 44.4555 28.783406 41.127547 23.350469 36.060547 20.105469 C 36.019547 20.079469 35.9785 20.051391 35.9375 20.025391 C 35.6015 19.814391 35.25625 19.615828 34.90625 19.423828 C 34.78325 19.355828 34.662109 19.285703 34.537109 19.220703 C 34.455109 19.177703 34.370109 19.140609 34.287109 19.099609 C 33.657109 20.630609 32.638469 21.961703 31.355469 22.970703 L 34.707031 26.322266 C 35.098031 26.713266 35.098031 27.345328 34.707031 27.736328 C 34.512031 27.931328 34.256 28.029297 34 28.029297 C 33.744 28.029297 33.487969 27.931328 33.292969 27.736328 L 32.455078 26.900391 L 30.648438 28.707031 C 30.453437 28.901031 30.197406 29 29.941406 29 C 29.685406 29 29.429375 28.902031 29.234375 28.707031 C 28.843375 28.316031 28.843375 27.683969 29.234375 27.292969 L 31.042969 25.484375 L 30 24.443359 L 28.707031 25.736328 C 28.512031 25.931328 28.256 26.029297 28 26.029297 C 27.744 26.029297 27.487969 25.931328 27.292969 25.736328 C 27.056969 25.500328 26.981297 25.178047 27.029297 24.873047 C 26.531297 24.954047 26.021 25 25.5 25 C 21.467 25 18.022484 22.470969 16.646484 18.917969 z M 20.5 40 A 1.5 1.5 0 0 0 19 41.5 A 1.5 1.5 0 0 0 20.5 43 A 1.5 1.5 0 0 0 22 41.5 A 1.5 1.5 0 0 0 20.5 40 z M 31.5 40 A 1.5 1.5 0 0 0 30 41.5 A 1.5 1.5 0 0 0 31.5 43 A 1.5 1.5 0 0 0 33 41.5 A 1.5 1.5 0 0 0 31.5 40 z" />
        </g>
    </symbol>
    <symbol id="icon-youtube" viewBox="0 0 16 16">
        <g>
            <path
                d="M15.841 4.8s-.156-1.103-.637-1.587c-.609-.637-1.291-.641-1.603-.678-2.237-.163-5.597-.163-5.597-.163h-.006s-3.359 0-5.597.163c-.313.038-.994.041-1.603.678C.317 3.697.164 4.8.164 4.8S.005 6.094.005 7.391v1.213c0 1.294.159 2.591.159 2.591s.156 1.103.634 1.588c.609.637 1.409.616 1.766.684 1.281.122 5.441.159 5.441.159s3.363-.006 5.6-.166c.313-.037.994-.041 1.603-.678.481-.484.637-1.588.637-1.588s.159-1.294.159-2.591V7.39c-.003-1.294-.162-2.591-.162-2.591zm-9.494 5.275V5.578l4.322 2.256-4.322 2.241z" />
        </g>
    </symbol>
</svg>
    <header class="l-header">
        
        <p class="c-title p-title"><a href="https://jeqo.github.io/" class="p-title__link">@jeqo</a></p>
         
        <p class="p-subtitle">
            data streaming, observability, automation, and random stuff
        </p>
        
    </header>
    
<ul class="c-links">
  
  <li class="c-links__item">
    <a href="https://twitter.com/jeqo89" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>twitter</title>
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://github.com/jeqo" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>github</title>
        <use xlink:href="#icon-github"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://keybase.io/jeqo" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>linkedin</title>
        <use xlink:href="#icon-keybase"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://linkedin.com/in/jeqo89" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>linkedin</title>
        <use xlink:href="#icon-linkedin"></use>
      </svg>
    </a>
  </li>
  
</ul>

 
<nav class="l-nav p-menu">
    <ul class="p-menu__lists">
         
        <li class="p-menu__listitem">
            <a href="/posts">Posts</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/til">TIL</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/notes">Notes</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/talks">Talks</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/projects">Projects</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/about">About</a>
        </li>
          
    </ul>
</nav>

    <main id="main" class="l-main">

<article class="p-article">
  <header>
    <h1>Vagrant and Chef Quickstart</h1>
    <div>
      <div class="c-time">
        Posted on
        <time datetime="2014-11-26T00:00:00Z">
          Nov 26, 2014
        </time>
      </div>
      
      <a href="https://jeqo.github.io/tags/vagrant" class="c-tag">vagrant</a>
      
      <a href="https://jeqo.github.io/tags/virtualbox" class="c-tag">virtualbox</a>
      
    </div>
  </header>
  
  <section id="js-article" class="p-article__body">
    <p>I have some months working with Vagrant and I think it&rsquo;s owesome! Integration with almost all kind of virtualization platforms: VirtalBox, VMware, Docker, AWS EC2, Hyper-V and so on. Also it&rsquo;s able to use differente Provisioners: Chef, Puppet, bash, Docker, Ansible. I really like it.</p>
<p>So, when I start working with Vagrant I choose VirtualBox as my virtualization platform and Chef as my provisioner, and when trying different configurations I start finding some tips to share:</p>
<ol>
<li>First step: Should I create my base box? or should I use a base box already created?</li>
<li>Can I increase my disk space? how?</li>
<li>Can I increase my swap memory? how?</li>
</ol>
<p>So, I decide to create a post to start creating Vagrant boxes and resolve this issues. Let&rsquo;s start:</p>
<blockquote>
<p>First of all, install <a href="https://www.vagrantup.com/downloads.html">Vagrant</a></p>
</blockquote>
<h2 id="create-a-vagrant-box">
    <a class="hash-link nohover" href="#create-a-vagrant-box">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Create a Vagrant Box
</h2><p>If you read Vagrant documentation, you will find everything is based in a <strong>box</strong>. What&rsquo;s a box? In my opinion, a box is an abstraction from a base virtual environment: It has an OS installed, some basic configuration, and packaged to be reused. And what&rsquo;s a <strong>base box</strong>? A base box is a template to create boxes. For instance: A VirtualBox <em>base box</em> is a VirtualBox VM with an OS installed, a disk space defined, and a basic configuration, and a <em>box</em> is a Virtual Machine up and running. An Amazon Web Service EC2 <em>box</em> is an instance and a <em>base box</em> is a <a href="https://github.com/mitchellh/vagrant-aws/tree/master/example_box">file containing an AMI id</a>, that is a Virtual Machine template from AWS.</p>
<p>Now that I know what is a box, how can I created? You can created by yourself: creating a simple VM, installing a base OS, and running a Vagrant command to create a &ldquo;base box&rdquo;. The process to do this depends on what virtualization platform you are using, for example: on VirtualBox you can do <a href="https://docs.vagrantup.com/v2/virtualbox/boxes.html">this</a> (official documentation) or a <a href="http://www.skoblenick.com/vagrant/creating-a-custom-box-from-scratch/">more detailed way</a>.</p>
<p>This process is easy, but what if you want to use a cloud base box to be sure that anyone will change a package or configuration? There are two sites that I found where you can search, use directly or download base boxes:</p>
<ul>
<li><a href="http://www.vagrantbox.es/">Vagrantbox.es</a></li>
<li><a href="https://vagrantcloud.com/">Vagrant Cloud</a> the Vagrant&rsquo;s official site</li>
</ul>
<p>Now you can search an specific distribution and use it whenever you want.</p>
<p>Ok, I have a base box, how can I use it to create a new box? The basic artifact you need is a Vagrant file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir vagrant-box
vagrant init</code></pre></div>
<p>Running this creates a <em>Vagrantfile</em> that contains the information to create a new box.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#036;font-weight:bold">VAGRANTFILE_API_VERSION</span> <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;2&#34;</span>

<span style="color:#036;font-weight:bold">Vagrant</span><span style="color:#333">.</span>configure(<span style="color:#036;font-weight:bold">VAGRANTFILE_API_VERSION</span>) <span style="color:#080;font-weight:bold">do</span> <span style="color:#333">|</span>config<span style="color:#333">|</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>box <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;base&#34;</span>
<span style="color:#080;font-weight:bold">end</span></code></pre></div>
<p>This <em>ruby</em> script starts a <em>method</em> where you have a variable <em>config</em> from <em>Vagrant.configure(&ldquo;2&rdquo;)</em>. This variable is what you use to start defining your <em>box</em> properties.</p>
<blockquote>
<p>First important command: <strong>vagrant init</strong></p>
</blockquote>
<p>This is not enough to create a box. You need two more attributes:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  <span style="color:#888"># URL or path to base box file</span>
  <span style="color:#888"># config.vm.box_url = &#34;https://storage.us2.oraclecloud.com/v1/istoilis-istoilis/vagrant/oel65-64.box&#34;</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>box_url <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;file://c:/boxes/oel65-64.box&#34;</span>
<span style="color:#333">...</span></code></pre></div>
<p>With this you can execute <em>vagrant up</em> to run the script. This will create a VM on VirtualBox with the same configuration as <em>base box</em>.</p>
<blockquote>
<p>Second important command: <strong>vagrant up [&ndash;provider=virtualbox]</strong></p>
</blockquote>
<p>You can validate a new VM is created from VirtualBox. Depending on your base box you will have certain ammount of RAM memory, disk space and cpu&rsquo;s.</p>
<p>Great! so if you only want to clone your VM, this is enough.</p>
<h2 id="customize-a-vagrant-box">
    <a class="hash-link nohover" href="#customize-a-vagrant-box">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Customize a Vagrant Box
</h2><p>What if I want to change my VM name? What if I want more memory? What if I want to create two instances?</p>
<p>All these customizations are possible from <em>Vagrantfile</em>.</p>
<p>Let&rsquo;s start changing VM resources:</p>
<p>As this is a virtualization platform specific requirement, you have to make these changes on an embedded method:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>provider <span style="color:#a60;background-color:#fff0f0">:virtualbox</span> <span style="color:#080;font-weight:bold">do</span> <span style="color:#333">|</span>vb<span style="color:#333">|</span>
    vb<span style="color:#333">.</span>customize <span style="color:#333">[</span><span style="background-color:#fff0f0">&#34;modifyvm&#34;</span>, <span style="color:#a60;background-color:#fff0f0">:id</span>, <span style="background-color:#fff0f0">&#34;--memory&#34;</span>, <span style="background-color:#fff0f0">&#34;2048&#34;</span><span style="color:#333">]</span>
    vb<span style="color:#333">.</span>customize <span style="color:#333">[</span><span style="background-color:#fff0f0">&#34;modifyvm&#34;</span>, <span style="color:#a60;background-color:#fff0f0">:id</span>, <span style="background-color:#fff0f0">&#34;--name&#34;</span>  , <span style="background-color:#fff0f0">&#34;basemachine&#34;</span><span style="color:#333">]</span>
    vb<span style="color:#333">.</span>customize <span style="color:#333">[</span><span style="background-color:#fff0f0">&#34;modifyvm&#34;</span>, <span style="color:#a60;background-color:#fff0f0">:id</span>, <span style="background-color:#fff0f0">&#34;--cpus&#34;</span>  , <span style="color:#00d;font-weight:bold">2</span><span style="color:#333">]</span>
    vb<span style="color:#333">.</span>customize <span style="color:#333">[</span><span style="background-color:#fff0f0">&#34;modifyvm&#34;</span>, <span style="color:#a60;background-color:#fff0f0">:id</span>, <span style="background-color:#fff0f0">&#34;--chipset&#34;</span>, <span style="background-color:#fff0f0">&#34;ich9&#34;</span><span style="color:#333">]</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#333">...</span></code></pre></div>
<p>In VirtualBox, these are the most important parameters: RAM memory (in MB), VM name, CPUs number, and chipset.</p>
<p>Ok, let&rsquo;s try it&hellip; wait, I already have a Vagrant box started</p>
<blockquote>
<p>Third important command: <strong>vagrant destroy</strong></p>
</blockquote>
<p>For me, this is the greatest benefit of using Vagrant, you can destroy you box and you don&rsquo;t care! Well,
you care if it&rsquo;s a box in production, but when you are creating your environment you can destroy and
recreate over and over again, fast and easy.</p>
<p>Run: <em>vagrant destroy</em>, and <em>vagrant up</em> again.</p>
<p>Now you know how to create and parametrize your Vagrant Box on VirtualBox.</p>
<p>Two more important parameters:</p>
<ul>
<li><strong>Network</strong>: By default your box use a NAT network that VirtualBox creates out-of-the-box. But, what if you (obviously) want to connect to your box? You need to use the &ldquo;Host-only&rdquo; network:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>network <span style="color:#a60;background-color:#fff0f0">:private_network</span>, <span style="color:#a60;background-color:#fff0f0">ip</span>: <span style="background-color:#fff0f0">&#34;192.168.56.XYZ&#34;</span>
<span style="color:#333">...</span></code></pre></div>
<blockquote>
<p>Normally this is the network IP: 192.168.56.1, so your VMs use this IP as gateway.</p>
</blockquote>
<ul>
<li><strong>Shared Directories</strong>: Using VirtualBox utility to create shared directories is annoying! With Vagrant is as easy as add thit to your script:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  <span style="color:#888"># Mount c:\data directory to /data directory on box. mount_options is optional</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>synced_folder <span style="background-color:#fff0f0">&#34;/data&#34;</span> , <span style="background-color:#fff0f0">&#34;/data&#34;</span>, <span style="color:#a60;background-color:#fff0f0">:mount_options</span> <span style="color:#333">=&gt;</span> <span style="color:#333">[</span><span style="background-color:#fff0f0">&#34;dmode=777&#34;</span>, <span style="background-color:#fff0f0">&#34;fmode=777&#34;</span><span style="color:#333">]</span>
<span style="color:#333">...</span></code></pre></div>
<p>Some other parameters:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  <span style="color:#888"># Hostname</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>hostname <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;basemachine&#34;</span>
<span style="color:#333">...</span></code></pre></div>
<p>For more information: <a href="https://docs.vagrantup.com/v2/vagrantfile/index.html">Vagrant Docs</a></p>
<h2 id="resolving-some-common-issues">
    <a class="hash-link nohover" href="#resolving-some-common-issues">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Resolving some common issues
</h2><p>Excellent! you can create and parametrized Vagrant boxes. If your base box have enough disk and swap size, perfect!
But, what if your base box have 10GB as disk space and your swap space is 512MB or less?</p>
<p>Well these issues took me a couple of days to resolve, so this is how to handle it:</p>
<h3 id="increase-disk-space">
    <a class="hash-link nohover" href="#increase-disk-space">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Increase Disk space
</h3><p>Normally (sadly), cloud base box comes with VMDK disks formats. If you are lucky and your disk format is VDI,
you can solve this directly <a href="http://derekmolloy.ie/resize-a-virtualbox-disk/">like this</a>. But, VMDK can&rsquo;t be expanded,
so you need to add another disk to your VM. If making this manually is hard, can you imaging doing this from Vagrant?
Well, now that I solved is not that difficult:</p>
<ol>
<li>Create an script called <em>&ldquo;bootstrap.sh&rdquo;</em> on your working directory, and add these lines:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">pvcreate /dev/sdb
vgextend VolGroup /dev/sdb
lvextend /dev/VolGroup/lv_root /dev/sdb
resize2fs /dev/VolGroup/lv_root</code></pre></div>
<blockquote>
<p>VolGroup and lv_root can change on different distributions. But it works for me on Ubuntu also.</p>
</blockquote>
<p>And then add this code to your <em>Vagrantfile</em>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>provider <span style="color:#a60;background-color:#fff0f0">:virtualbox</span> <span style="color:#080;font-weight:bold">do</span> <span style="color:#333">|</span>vb<span style="color:#333">|</span>
  <span style="color:#333">...</span>
  <span style="color:#888"># Validate this should be run it once</span>
  <span style="color:#080;font-weight:bold">if</span> <span style="color:#036;font-weight:bold">ARGV</span><span style="color:#333">[</span><span style="color:#00d;font-weight:bold">0</span><span style="color:#333">]</span> <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;up&#34;</span> <span style="color:#333">&amp;&amp;</span> <span style="color:#333">!</span> <span style="color:#036;font-weight:bold">File</span><span style="color:#333">.</span>exist?(<span style="background-color:#fff0f0">&#34;./disk1.vdi&#34;</span>)
    vb<span style="color:#333">.</span>customize <span style="color:#333">[</span>
      <span style="background-color:#fff0f0">&#39;createhd&#39;</span>,
      <span style="background-color:#fff0f0">&#39;--filename&#39;</span>, <span style="background-color:#fff0f0">&#34;./disk1.vdi&#34;</span>,
      <span style="background-color:#fff0f0">&#39;--format&#39;</span>, <span style="background-color:#fff0f0">&#39;VDI&#39;</span>,
      <span style="color:#888"># 100GB</span>
      <span style="background-color:#fff0f0">&#39;--size&#39;</span>, <span style="color:#00d;font-weight:bold">100</span> <span style="color:#333">*</span> <span style="color:#00d;font-weight:bold">1024</span>
    <span style="color:#333">]</span>

    vb<span style="color:#333">.</span>customize <span style="color:#333">[</span>
      <span style="background-color:#fff0f0">&#39;storageattach&#39;</span>, <span style="color:#a60;background-color:#fff0f0">:id</span>,
      <span style="background-color:#fff0f0">&#39;--storagectl&#39;</span>, <span style="background-color:#fff0f0">&#39;SATA Controller&#39;</span>,
      <span style="background-color:#fff0f0">&#39;--port&#39;</span>, <span style="color:#00d;font-weight:bold">1</span>, <span style="background-color:#fff0f0">&#39;--device&#39;</span>, <span style="color:#00d;font-weight:bold">0</span>,
      <span style="background-color:#fff0f0">&#39;--type&#39;</span>, <span style="background-color:#fff0f0">&#39;hdd&#39;</span>, <span style="background-color:#fff0f0">&#39;--medium&#39;</span>,
      file_to_disk
    <span style="color:#333">]</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">if</span> <span style="color:#036;font-weight:bold">ARGV</span><span style="color:#333">[</span><span style="color:#00d;font-weight:bold">0</span><span style="color:#333">]</span> <span style="color:#333">==</span> <span style="background-color:#fff0f0">&#34;up&#34;</span> <span style="color:#333">&amp;&amp;</span> <span style="color:#333">!</span> <span style="color:#036;font-weight:bold">File</span><span style="color:#333">.</span>exist?(<span style="background-color:#fff0f0">&#34;./disk1.vdi&#34;</span>)
    <span style="color:#888"># Run script to map new disk</span>
    config<span style="color:#333">.</span>vm<span style="color:#333">.</span>provision <span style="background-color:#fff0f0">&#34;shell&#34;</span>, <span style="color:#a60;background-color:#fff0f0">path</span>: <span style="background-color:#fff0f0">&#34;bootstrap.sh&#34;</span>
    <span style="color:#888"># Run script to increase swap memory</span>
    config<span style="color:#333">.</span>vm<span style="color:#333">.</span>provision <span style="background-color:#fff0f0">&#34;shell&#34;</span>, <span style="color:#a60;background-color:#fff0f0">path</span>: <span style="background-color:#fff0f0">&#34;increase_swap.sh&#34;</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#333">...</span></code></pre></div>
<p>This creates a VDI disk file with 100GB of capacity. And is attached to your OS.</p>
<blockquote>
<p>This problem is solved when you create cloud Vagrant boxes, like AWS EC2 instances with Vagrant :D</p>
</blockquote>
<h3 id="increase-swap-memory">
    <a class="hash-link nohover" href="#increase-swap-memory">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Increase Swap Memory
</h3><p>As I install Oracle Fusion Middleware products, they require some amount of swap memory, but <em>base box</em> comes with a small amount of swap.</p>
<p>To resolve this, add this script called <em>&ldquo;increase_swap.sh&rdquo;</em> on your working directory:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#579">#!/bin/sh
</span><span style="color:#579"></span>
<span style="color:#888"># size of swapfile in megabytes</span>
<span style="color:#963">swapsize</span><span style="color:#333">=</span><span style="color:#60e;font-weight:bold">8000</span>

<span style="color:#888"># does the swap file already exist?</span>
grep -q <span style="background-color:#fff0f0">&#34;swapfile&#34;</span> /etc/fstab

<span style="color:#888"># if not then create it</span>
<span style="color:#080;font-weight:bold">if</span> <span style="color:#333">[</span> <span style="color:#963">$?</span> -ne <span style="color:#60e;font-weight:bold">0</span> <span style="color:#333">]</span>; <span style="color:#080;font-weight:bold">then</span>
  <span style="color:#007020">echo</span> <span style="background-color:#fff0f0">&#39;swapfile not found. Adding swapfile.&#39;</span>
  fallocate -l <span style="background-color:#eee">${</span><span style="color:#963">swapsize</span><span style="background-color:#eee">}</span>M /swapfile
  chmod <span style="color:#60e;font-weight:bold">600</span> /swapfile
  mkswap /swapfile
  swapon /swapfile
  <span style="color:#007020">echo</span> <span style="background-color:#fff0f0">&#39;/swapfile none swap defaults 0 0&#39;</span> &gt;&gt; /etc/fstab
<span style="color:#080;font-weight:bold">else</span>
  <span style="color:#007020">echo</span> <span style="background-color:#fff0f0">&#39;swapfile found. No changes made.&#39;</span>
<span style="color:#080;font-weight:bold">fi</span>

<span style="color:#888"># output results to terminal</span>
df -h
cat /proc/swaps
cat /proc/meminfo | grep Swap</code></pre></div>
<p>If you destroy and up your box now, you will have a new box with 8GB of swap memory added and 100GB of additional disk space.</p>
<h2 id="additional-tricks">
    <a class="hash-link nohover" href="#additional-tricks">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Additional tricks
</h2><h3 id="get-started-with-chef-provisioning">
    <a class="hash-link nohover" href="#get-started-with-chef-provisioning">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Get Started with Chef (Provisioning!)
</h3><p>What if you want to install some package or service? You can do this with a bash (as we increase memory and disk) but is not flexible and can take a lot of effort. At this days provisioning is a trend and products as Docker, Puppet and Chef are getting very popular, so I will use Chef to show you how to install Apache and start HTTP service:</p>
<blockquote>
<p>To learn more about chef: <a href="http://learn.getchef.com">Learn Chef</a></p>
</blockquote>
<p>Create the following directories and create a file:</p>
<p>chef/cookbooks/http/recipes/install-httpd.rb</p>
<p>Chef base artifacts are Cookbooks that group common Recipes. For example you can create a Cookbook called &ldquo;java&rdquo; and add recipes to install different versions.</p>
<p>Add this code to the file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">package <span style="background-color:#fff0f0">&#34;httpd&#34;</span> <span style="color:#080;font-weight:bold">do</span>
  action <span style="color:#a60;background-color:#fff0f0">:install</span>
<span style="color:#080;font-weight:bold">end</span>

service <span style="background-color:#fff0f0">&#34;httpd&#34;</span> <span style="color:#080;font-weight:bold">do</span>
  action <span style="color:#333">[</span> <span style="color:#a60;background-color:#fff0f0">:start</span>, <span style="color:#a60;background-color:#fff0f0">:enable</span> <span style="color:#333">]</span>
<span style="color:#080;font-weight:bold">end</span></code></pre></div>
<p>This recipe <em>install</em> &ldquo;httpd&rdquo; package and ensure service &ldquo;httpd&rdquo; is <em>started</em> and will be started when the machine is restarted.</p>
<p>To call this simple recipe from Vagrant you need to add this to your file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>provision <span style="background-color:#fff0f0">&#34;chef_solo&#34;</span> <span style="color:#080;font-weight:bold">do</span> <span style="color:#333">|</span>chef<span style="color:#333">|</span>
    chef<span style="color:#333">.</span>cookbooks_path <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;../chef/cookbooks&#34;</span>
    chef<span style="color:#333">.</span>add_recipe <span style="background-color:#fff0f0">&#34;http::install-httpd&#34;</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#333">...</span></code></pre></div>
<blockquote>
<p><em>chef-solo</em> is when you use your client independently, and <em>chef-client</em> is when you use a Chef Server</p>
</blockquote>
<p>Now if you destroy and re-create your Vagrant box again you could test that your HTTP server is up and running</p>
<p>[http://ip or hostname](http://ip or host)</p>
<h3 id="properties-file">
    <a class="hash-link nohover" href="#properties-file">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Properties file
</h3><p>The last trick I want to share is how to create a properties file for your Vagrant configuration.</p>
<p>What if you want to repeat this process to create another box? You can parametrized your Vagrantfile with a properties file.</p>
<p>To do this:</p>
<ul>
<li>Create a file like this one called &ldquo;vagrant.rb&rdquo;:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#070">box</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">name</span>:<span style="color:#bbb"> </span><span style="background-color:#fff0f0">&#34;base-machine&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">disk_path</span>:<span style="color:#bbb"> </span><span style="background-color:#fff0f0">&#34;./disk1.vdi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">url</span>:<span style="color:#bbb"> </span><span style="background-color:#fff0f0">&#34;file://c:/boxes/oel65-64.box&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">ip</span>:<span style="color:#bbb"> </span><span style="background-color:#fff0f0">&#34;192.168.56.20&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">shared_directory</span>:<span style="color:#bbb"> </span><span style="background-color:#fff0f0">&#34;/data&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">disk_size</span>:<span style="color:#bbb"> </span><span style="color:#60e;font-weight:bold">40</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">ram_memory</span>:<span style="color:#bbb"> </span><span style="color:#60e;font-weight:bold">2048</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">cpus</span>:<span style="color:#bbb"> </span><span style="color:#60e;font-weight:bold">2</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">swap_memory</span>:<span style="color:#bbb"> </span><span style="color:#60e;font-weight:bold">4096</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#070">chef</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#070">repo_location</span>:<span style="color:#bbb"> </span><span style="background-color:#fff0f0">&#34;C:/dev/jeqo/chef-repo&#34;</span></code></pre></div>
<ul>
<li>Add the &ldquo;yaml&rdquo; library:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">  <span style="color:#007020">require</span> <span style="background-color:#fff0f0">&#34;yaml&#34;</span></code></pre></div>
<ul>
<li>Then read and use properties:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#333">...</span>
  props <span style="color:#333">=</span> <span style="color:#036;font-weight:bold">YAML</span><span style="color:#333">.</span>load_file(<span style="background-color:#fff0f0">&#34;vagrant.rb&#34;</span>)

  config<span style="color:#333">.</span>vm<span style="color:#333">.</span>box <span style="color:#333">=</span> <span style="background-color:#fff0f0">&#34;</span><span style="background-color:#eee">#{</span>props<span style="color:#333">[</span><span style="background-color:#fff0f0">&#39;box&#39;</span><span style="color:#333">][</span><span style="background-color:#fff0f0">&#39;name&#39;</span><span style="color:#333">]</span><span style="background-color:#eee">}</span><span style="background-color:#fff0f0">&#34;</span>
<span style="color:#333">...</span></code></pre></div>
<p>Well, it&rsquo;s a long but (i hope) an easy post. I hope you enjoyed :)</p>
<p>Here is the <a href="https://github.com/jeqo/vagrant-quickstart">Git repository</a></p>
<p>Feel free to send your comments and question!</p>
<blockquote>
<p>Disclosure: I&rsquo;m not a Ruby developer (yet), so if I&rsquo;m using a wrong term about ruby code sorry :)  I just trying to describe the source code, that I think is enough for Vagrant files.</p>
</blockquote>
<h4 id="resources">
    <a class="hash-link nohover" href="#resources">
        <img src="/img/hashtag.svg" width="20" height="20"></img>
    </a>&nbsp;Resources
</h4><ul>
<li>
<p>Vagrant Docs: <a href="https://docs.vagrantup.com/v2/">https://docs.vagrantup.com/v2/</a></p>
</li>
<li>
<p>Increase Swap: <a href="http://programmaticponderings.wordpress.com/2013/12/19/scripting-linux-swap-space/">http://programmaticponderings.wordpress.com/2013/12/19/scripting-linux-swap-space/</a></p>
</li>
<li>
<p>Add a new disk to VirtualBox VM with Vagrant: <a href="https://gist.github.com/leifg/4713995">https://gist.github.com/leifg/4713995</a></p>
</li>
<li>
<p>Getting started with Chef: <a href="https://learn.getchef.com">https://learn.getchef.com</a></p>
</li>
<li>
<p>VirtualBox API documentation: <a href="https://www.virtualbox.org/manual/ch08.html">https://www.virtualbox.org/manual/ch08.html</a></p>
</li>
</ul>
  </section>
  <footer>
    
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'jeqoblog';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <nav class="p-pagination c-pagination">
      <div class="c-pagination__ctrl">
        <div class="c-pagination__newer">
          
          
        </div>
        <div class="c-pagination__older">
          
          <a href="https://jeqo.github.io/posts/2014-11-28-review-soa-patterns-oracle-platform/">Older</a>
          
        </div>
      </div>
    </nav>
    


  </footer>
</article>
  </main>
  
<nav class="l-nav p-menu">
    <ul class="p-menu__lists">
         
        <li class="p-menu__listitem">
            <a href="/posts">Posts</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/til">TIL</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/notes">Notes</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/talks">Talks</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/projects">Projects</a>
        </li>
          
        <li class="p-menu__listitem">
            <a href="/about">About</a>
        </li>
          
    </ul>
</nav>

  <footer class="l-footer">
    
<ul class="c-links">
  
  <li class="c-links__item">
    <a href="https://twitter.com/jeqo89" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>twitter</title>
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://github.com/jeqo" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>github</title>
        <use xlink:href="#icon-github"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://keybase.io/jeqo" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>linkedin</title>
        <use xlink:href="#icon-keybase"></use>
      </svg>
    </a>
  </li>
  
  
  <li class="c-links__item">
    <a href="https://linkedin.com/in/jeqo89" target="_blank">
      <svg viewBox="0 0 64 64" class="c-links__icon">
        <title>linkedin</title>
        <use xlink:href="#icon-linkedin"></use>
      </svg>
    </a>
  </li>
  
</ul>



    <p class="p-copyright">
      
        &copy; Copyright @jeqo
      
    </p>
  </footer>

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49047812-3', 'auto');
    ga('send', 'pageview');
  </script>
  

</body>
</html>

